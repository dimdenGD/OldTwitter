const stringWorker=fn=>new Worker(window.URL.createObjectURL(new Blob([fn],{type:"text/javascript"})));fetch(chrome.runtime.getURL("libraries/gif.worker.js")).then(response=>response.text()).then(workerCode=>{!function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{var g;(g="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).GIF=f()}}((function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,(function(e){var n=t[o][1][e];return s(n||e)}),l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){function EventEmitter(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function isFunction(arg){return"function"==typeof arg}function isNumber(arg){return"number"==typeof arg}function isObject(arg){return"object"==typeof arg&&null!==arg}function isUndefined(arg){return void 0===arg}module.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=10,EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||n<0||isNaN(n))throw TypeError("n must be a positive number");return this._maxListeners=n,this},EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(this._events||(this._events={}),"error"===type&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length)){if((er=arguments[1])instanceof Error)throw er;var err=new Error('Uncaught, unspecified "error" event. ('+er+")");throw err.context=er,err}if(isUndefined(handler=this._events[type]))return!1;if(isFunction(handler))switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:args=Array.prototype.slice.call(arguments,1),handler.apply(this,args)}else if(isObject(handler))for(args=Array.prototype.slice.call(arguments,1),len=(listeners=handler.slice()).length,i=0;i<len;i++)listeners[i].apply(this,args);return!0},EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener),this._events[type]?isObject(this._events[type])?this._events[type].push(listener):this._events[type]=[this._events[type],listener]:this._events[type]=listener,isObject(this._events[type])&&!this._events[type].warned&&(m=isUndefined(this._maxListeners)?EventEmitter.defaultMaxListeners:this._maxListeners)&&m>0&&this._events[type].length>m&&(this._events[type].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[type].length),"function"==typeof console.trace&&console.trace()),this},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.once=function(type,listener){if(!isFunction(listener))throw TypeError("listener must be a function");var fired=!1;function g(){this.removeListener(type,g),fired||(fired=!0,listener.apply(this,arguments))}return g.listener=listener,this.on(type,g),this},EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;if(length=(list=this._events[type]).length,position=-1,list===listener||isFunction(list.listener)&&list.listener===listener)delete this._events[type],this._events.removeListener&&this.emit("removeListener",type,listener);else if(isObject(list)){for(i=length;i-- >0;)if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}if(position<0)return this;1===list.length?(list.length=0,delete this._events[type]):list.splice(position,1),this._events.removeListener&&this.emit("removeListener",type,listener)}return this},EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[type]&&delete this._events[type],this;if(0===arguments.length){for(key in this._events)"removeListener"!==key&&this.removeAllListeners(key);return this.removeAllListeners("removeListener"),this._events={},this}if(isFunction(listeners=this._events[type]))this.removeListener(type,listeners);else if(listeners)for(;listeners.length;)this.removeListener(type,listeners[listeners.length-1]);return delete this._events[type],this},EventEmitter.prototype.listeners=function(type){var ret;return ret=this._events&&this._events[type]?isFunction(this._events[type])?[this._events[type]]:this._events[type].slice():[]},EventEmitter.prototype.listenerCount=function(type){if(this._events){var evlistener=this._events[type];if(isFunction(evlistener))return 1;if(evlistener)return evlistener.length}return 0},EventEmitter.listenerCount=function(emitter,type){return emitter.listenerCount(type)}},{}],2:[function(require,module,exports){var UA,browser,mode,platform,ua;ua=navigator.userAgent.toLowerCase(),platform=navigator.platform.toLowerCase(),mode="ie"===(UA=ua.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0])[1]&&document.documentMode,(browser={name:"version"===UA[1]?UA[3]:UA[1],version:mode||parseFloat("opera"===UA[1]&&UA[4]?UA[4]:UA[2]),platform:{name:ua.match(/ip(?:ad|od|hone)/)?"ios":(ua.match(/(?:webos|android)/)||platform.match(/mac|win|linux/)||["other"])[0]}})[browser.name]=!0,browser[browser.name+parseInt(browser.version,10)]=!0,browser.platform[browser.platform.name]=!0,module.exports=browser},{}],3:[function(require,module,exports){var EventEmitter,GIF,browser,extend=function(child,parent){for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);function ctor(){this.constructor=child}return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty,indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++)if(i in this&&this[i]===item)return i;return-1},slice=[].slice;EventEmitter=require("events").EventEmitter,browser=require("./browser.coffee"),GIF=function(superClass){var defaults,frameDefaults;function GIF(options){var base,key,value;for(key in this.running=!1,this.options={},this.frames=[],this.freeWorkers=[],this.activeWorkers=[],this.setOptions(options),defaults)value=defaults[key],null==(base=this.options)[key]&&(base[key]=value)}return extend(GIF,superClass),defaults={workerScript:chrome.runtime.getURL("libraries/gif.worker.js"),workers:2,repeat:0,background:"#fff",quality:10,width:null,height:null,transparent:null,debug:!1,dither:!1},frameDefaults={delay:500,copy:!1},GIF.prototype.setOption=function(key,value){if(this.options[key]=value,null!=this._canvas&&("width"===key||"height"===key))return this._canvas[key]=value},GIF.prototype.setOptions=function(options){var key,results,value;for(key in results=[],options)hasProp.call(options,key)&&(value=options[key],results.push(this.setOption(key,value)));return results},GIF.prototype.addFrame=function(image,options){var frame,key;for(key in null==options&&(options={}),(frame={}).transparent=this.options.transparent,frameDefaults)frame[key]=options[key]||frameDefaults[key];if(null==this.options.width&&this.setOption("width",image.width),null==this.options.height&&this.setOption("height",image.height),"undefined"!=typeof ImageData&&null!==ImageData&&image instanceof ImageData)frame.data=image.data;else if("undefined"!=typeof CanvasRenderingContext2D&&null!==CanvasRenderingContext2D&&image instanceof CanvasRenderingContext2D||"undefined"!=typeof WebGLRenderingContext&&null!==WebGLRenderingContext&&image instanceof WebGLRenderingContext)options.copy?frame.data=this.getContextData(image):frame.context=image;else{if(null==image.childNodes)throw new Error("Invalid image");options.copy?frame.data=this.getImageData(image):frame.image=image}return this.frames.push(frame)},GIF.prototype.render=function(){var i,j,numWorkers,ref;if(this.running)throw new Error("Already running");if(null==this.options.width||null==this.options.height)throw new Error("Width and height must be set prior to rendering");if(this.running=!0,this.nextFrame=0,this.finishedFrames=0,this.imageParts=function(){var j,ref,results;for(results=[],i=j=0,ref=this.frames.length;0<=ref?j<ref:j>ref;i=0<=ref?++j:--j)results.push(null);return results}.call(this),numWorkers=this.spawnWorkers(),!0===this.options.globalPalette)this.renderNextFrame();else for(i=j=0,ref=numWorkers;0<=ref?j<ref:j>ref;i=0<=ref?++j:--j)this.renderNextFrame();return this.emit("start"),this.emit("progress",0)},GIF.prototype.abort=function(){for(var worker;null!=(worker=this.activeWorkers.shift());)this.log("killing active worker"),worker.terminate();return this.running=!1,this.emit("abort")},GIF.prototype.spawnWorkers=function(){var j,numWorkers,ref,results,_this;return numWorkers=Math.min(this.options.workers,this.frames.length),function(){results=[];for(var j=ref=this.freeWorkers.length;ref<=numWorkers?j<numWorkers:j>numWorkers;ref<=numWorkers?j++:j--)results.push(j);return results}.apply(this).forEach((_this=this,function(i){var worker;return _this.log("spawning worker "+i),(worker=stringWorker(workerCode)).onmessage=function(event){return _this.activeWorkers.splice(_this.activeWorkers.indexOf(worker),1),_this.freeWorkers.push(worker),_this.frameFinished(event.data)},_this.freeWorkers.push(worker)})),numWorkers},GIF.prototype.frameFinished=function(frame){var i,j,ref;if(this.log("frame "+frame.index+" finished - "+this.activeWorkers.length+" active"),this.finishedFrames++,this.emit("progress",this.finishedFrames/this.frames.length),this.imageParts[frame.index]=frame,!0===this.options.globalPalette&&(this.options.globalPalette=frame.globalPalette,this.log("global palette analyzed"),this.frames.length>2))for(i=j=1,ref=this.freeWorkers.length;1<=ref?j<ref:j>ref;i=1<=ref?++j:--j)this.renderNextFrame();return indexOf.call(this.imageParts,null)>=0?this.renderNextFrame():this.finishRendering()},GIF.prototype.finishRendering=function(){var data,frame,i,image,j,k,l,len,len1,len2,len3,offset,page,ref,ref1,ref2;for(len=0,j=0,len1=(ref=this.imageParts).length;j<len1;j++)len+=((frame=ref[j]).data.length-1)*frame.pageSize+frame.cursor;for(len+=frame.pageSize-frame.cursor,this.log("rendering finished - filesize "+Math.round(len/1e3)+"kb"),data=new Uint8Array(len),offset=0,k=0,len2=(ref1=this.imageParts).length;k<len2;k++)for(i=l=0,len3=(ref2=(frame=ref1[k]).data).length;l<len3;i=++l)page=ref2[i],data.set(page,offset),i===frame.data.length-1?offset+=frame.cursor:offset+=frame.pageSize;return image=new Blob([data],{type:"image/gif"}),this.emit("finished",image,data)},GIF.prototype.renderNextFrame=function(){var frame,task,worker;if(0===this.freeWorkers.length)throw new Error("No free workers");if(!(this.nextFrame>=this.frames.length))return frame=this.frames[this.nextFrame++],worker=this.freeWorkers.shift(),task=this.getTask(frame),this.emit("working",task.index+1, this.frames.length),this.log("starting frame "+(task.index+1)+" of "+this.frames.length),this.activeWorkers.push(worker),worker.postMessage(task)},GIF.prototype.getContextData=function(ctx){return ctx.getImageData(0,0,this.options.width,this.options.height).data},GIF.prototype.getImageData=function(image){var ctx;return null==this._canvas&&(this._canvas=document.createElement("canvas"),this._canvas.width=this.options.width,this._canvas.height=this.options.height),(ctx=this._canvas.getContext("2d")).setFill=this.options.background,ctx.fillRect(0,0,this.options.width,this.options.height),ctx.drawImage(image,0,0),this.getContextData(ctx)},GIF.prototype.getTask=function(frame){var index,task;if(task={index:index=this.frames.indexOf(frame),last:index===this.frames.length-1,delay:frame.delay,transparent:frame.transparent,width:this.options.width,height:this.options.height,quality:this.options.quality,dither:this.options.dither,globalPalette:this.options.globalPalette,repeat:this.options.repeat,canTransfer:"chrome"===browser.name},null!=frame.data)task.data=frame.data;else if(null!=frame.context)task.data=this.getContextData(frame.context);else{if(null==frame.image)throw new Error("Invalid frame");task.data=this.getImageData(frame.image)}return task},GIF.prototype.log=function(){var args;if(args=1<=arguments.length?slice.call(arguments,0):[],this.options.debug)return console.log.apply(console,args)},GIF}(EventEmitter),module.exports=GIF},{"./browser.coffee":2,events:1}]},{},[3])(3)}))});